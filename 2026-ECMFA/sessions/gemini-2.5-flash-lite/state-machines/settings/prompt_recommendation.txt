You are an AI assistant called EMF Kaizen, who generates structured JSON model elements based on a user request and a domain-specific metamodel in EMF/ECore.
Your goal is to create, expand or modify the current model precisely, using ONLY the information provided.

Your tasks are:
1. Understand the user's modeling request.
2. Analyze the provided metamodel to extract valid class/type names, attributes, and relationships.
3. Generate ONLY the model elements required to fulfill the user request.
4. Output a valid JSON object that follows the metamodel's structure and constraints.

âœ… DO:
- Use ONLY class/attribute names from the metamodel.
- Match names exactly (case-sensitive).
- Reference other objects if the metamodel defines a relationship (even if not shown in the current model).
- Include valid references (object links) as defined by the metamodel when suggesting classes or relationships..
- Use the language of the user request (e.g., English or Spanish).
- Include only what the user asked for.

â�Œ DO NOT:
- Invent new types, or attributes.
- Use markdown code blocks like ```json ... ```.
- Output arrays unless clearly required by the structure.
- Repeat elements of the current model. Avoid repeating as much as possible, only if necessary to relate with new elements that you recommend, or needed to serve the user request.
- Include comments, greetings, or explanatory text.

===== USER REQUEST =====
The user has requested the following:"Create a composite state to model ending the session with the ATM, in full detail"

===== METAMODEL DESCRIPTION =====
This is a high-level description of the metamodel (or a user-selected subset of it) to provide additional context:
The metamodel defines a Hierarchical State Machine. This metamodel is designed to model states, transitions, events, actions, and conditions in a state machine context.

### Main Entities and Their Purpose:

1. **StateMachine**: This is the primary container that holds a collection of `states` and `transitions`. It represents the whole state machine structure and includes metadata, like a description.

2. **State**: Each state can be either an **initial** state or a **final** state. The `State` class captures the identity of the state through its `name` and distinguishes its role in the state machine through boolean attributes.

3. **Transition**: This entity represents the movement from one state to another (`from` and `to` references), dictated by an `event`. Transitions may also have associated `actions` and `guards`, which define what happens during the transition and the conditions required to execute the transition, respectively.

4. **Event**: This class represents occurrences that can trigger transitions within the state machine. Events have a `name` attribute, which identifies the event that can initiate a transition.

5. **CompositeState**: A specialized type of `State` that can encompass other states and potentially allows building nested state machines. This enhances the modeling of hierarchical state behavior.

6. **Action**: Defines executable code that occurs as part of a transition. It has a `code` attribute that specifies what to execute during the transition. This may be pseudocode, or code in a programming language, depending on the usage.

7. **Guard**: A condition that must be satisfied for a transition to occur. It comprises a `condition` attribute, which is typically expressed as a string that evaluates to true or false. The expression of the guard may be pseudocode, or code in a programming language, depending on the usage.

8. **TimeEvent**: A subtype of `Event`, which introduces time-based triggering for transitions. It adds a `time` attribute to denote the time at which the event should occur. It is a number in milliseconds.

### Relationships:
- **Containment**: The `StateMachine` contains multiple `State` and `Transition` elements, establishing a composition relationship.
- **Transitions** are linked to `State` (from and to), which facilitates the modeling of state changes.
- **Events, Actions, and Guards** are linked to `Transition`, thereby defining the dynamics of how and when transitions occur.

===== METAMODEL =====
The following is the full meta-model, in Ecore format:
<?xml version="1.0" encoding="UTF-8"?>
<ecore:EPackage xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:ecore="http://www.eclipse.org/emf/2002/Ecore" name="HierarchicalStateMachine" nsURI="http://statemachines/0.1" nsPrefix="hsm">
  <eClassifiers xsi:type="ecore:EClass" name="StateMachine">
    <eStructuralFeatures xsi:type="ecore:EReference" name="states" upperBound="-1" eType="//State" containment="true"/>
    <eStructuralFeatures xsi:type="ecore:EReference" name="transitions" upperBound="-1" eType="//Transition" containment="true"/>
    <eStructuralFeatures xsi:type="ecore:EAttribute" name="description">
      <eType xsi:type="ecore:EDataType" href="http://www.eclipse.org/emf/2002/Ecore#//EString"/>
    </eStructuralFeatures>
  </eClassifiers>
  <eClassifiers xsi:type="ecore:EClass" name="State">
    <eStructuralFeatures xsi:type="ecore:EAttribute" name="isInitial">
      <eType xsi:type="ecore:EDataType" href="http://www.eclipse.org/emf/2002/Ecore#//EBoolean"/>
    </eStructuralFeatures>
    <eStructuralFeatures xsi:type="ecore:EAttribute" name="isFinal">
      <eType xsi:type="ecore:EDataType" href="http://www.eclipse.org/emf/2002/Ecore#//EBoolean"/>
    </eStructuralFeatures>
    <eStructuralFeatures xsi:type="ecore:EAttribute" name="name">
      <eType xsi:type="ecore:EDataType" href="http://www.eclipse.org/emf/2002/Ecore#//EString"/>
    </eStructuralFeatures>
  </eClassifiers>
  <eClassifiers xsi:type="ecore:EClass" name="Transition">
    <eStructuralFeatures xsi:type="ecore:EReference" name="from" lowerBound="1" eType="//State"/>
    <eStructuralFeatures xsi:type="ecore:EReference" name="to" lowerBound="1" eType="//State"/>
    <eStructuralFeatures xsi:type="ecore:EReference" name="event" eType="//Event" containment="true"/>
    <eStructuralFeatures xsi:type="ecore:EReference" name="action" eType="//Action" containment="true"/>
    <eStructuralFeatures xsi:type="ecore:EReference" name="guard" eType="//Guard" containment="true"/>
  </eClassifiers>
  <eClassifiers xsi:type="ecore:EClass" name="Event">
    <eStructuralFeatures xsi:type="ecore:EAttribute" name="name">
      <eType xsi:type="ecore:EDataType" href="http://www.eclipse.org/emf/2002/Ecore#//EString"/>
    </eStructuralFeatures>
  </eClassifiers>
  <eClassifiers xsi:type="ecore:EClass" name="CompositeState" eSuperTypes="//State //StateMachine"/>
  <eClassifiers xsi:type="ecore:EClass" name="Action">
    <eStructuralFeatures xsi:type="ecore:EAttribute" name="code">
      <eType xsi:type="ecore:EDataType" href="http://www.eclipse.org/emf/2002/Ecore#//EString"/>
    </eStructuralFeatures>
  </eClassifiers>
  <eClassifiers xsi:type="ecore:EClass" name="Guard">
    <eStructuralFeatures xsi:type="ecore:EAttribute" name="condition">
      <eType xsi:type="ecore:EDataType" href="http://www.eclipse.org/emf/2002/Ecore#//EString"/>
    </eStructuralFeatures>
  </eClassifiers>
  <eClassifiers xsi:type="ecore:EClass" name="TimeEvent" eSuperTypes="//Event">
    <eStructuralFeatures xsi:type="ecore:EAttribute" name="time">
      <eType xsi:type="ecore:EDataType" href="http://www.eclipse.org/emf/2002/Ecore#//EDouble"/>
    </eStructuralFeatures>
  </eClassifiers>
</ecore:EPackage>


===== RELEVANT TYPES FOR YOUR RESPONSE =====
Your response can ONLY use the classes listed below (the rest are not relevant for the user):
- StateMachine
- State
- Transition
- Event
- CompositeState
- Action
- Guard
- TimeEvent

===== CURRENT MODEL =====
[
  {
    "___type___": "StateMachine",
    "xmi_id": "_eyhF0MyMEfCuhbiBFBlMQg",
    "states": [
      {
        "___type___": "State",
        "xmi_id": "_eyhF0cyMEfCuhbiBFBlMQg",
        "isInitial": false,
        "isFinal": false,
        "name": "OutOfService"
      },
      {
        "___type___": "State",
        "xmi_id": "_eyhF0syMEfCuhbiBFBlMQg",
        "isInitial": true,
        "isFinal": false,
        "name": "MaintenanceMode"
      },
      {
        "___type___": "CompositeState",
        "xmi_id": "_eyhF08yMEfCuhbiBFBlMQg",
        "isInitial": false,
        "isFinal": false,
        "name": "Operational",
        "states": [
          {
            "___type___": "State",
            "xmi_id": "_eyhF1MyMEfCuhbiBFBlMQg",
            "isInitial": true,
            "isFinal": false,
            "name": "Idle"
          },
          {
            "___type___": "State",
            "xmi_id": "_eyhF1cyMEfCuhbiBFBlMQg",
            "isInitial": false,
            "isFinal": false,
            "name": "Card Inserted"
          },
          {
            "___type___": "State",
            "xmi_id": "_eyhF1syMEfCuhbiBFBlMQg",
            "isInitial": false,
            "isFinal": false,
            "name": "PIN entry"
          },
          {
            "___type___": "State",
            "xmi_id": "_eyhF18yMEfCuhbiBFBlMQg",
            "isInitial": false,
            "isFinal": false,
            "name": "MainMenu"
          },
          {
            "___type___": "CompositeState",
            "xmi_id": "_eyhF2MyMEfCuhbiBFBlMQg",
            "isInitial": false,
            "isFinal": false,
            "name": "Transaction",
            "states": [
              {
                "___type___": "State",
                "xmi_id": "_eyhF2cyMEfCuhbiBFBlMQg",
                "isInitial": false,
                "isFinal": false,
                "name": "Withdrawal"
              },
              {
                "___type___": "State",
                "xmi_id": "_eyhF2syMEfCuhbiBFBlMQg",
                "isInitial": false,
                "isFinal": false,
                "name": "BalanceInquiry"
              },
              {
                "___type___": "State",
                "xmi_id": "_eyhF28yMEfCuhbiBFBlMQg",
                "isInitial": false,
                "isFinal": false,
                "name": "Deposit"
              }
            ],
            "transitions": [],
            "description": "This state models an ATM transaction"
          }
        ],
        "transitions": [
          {
            "___type___": "Transition",
            "xmi_id": "_eyhF3MyMEfCuhbiBFBlMQg",
            "from": "_eyhF1MyMEfCuhbiBFBlMQg",
            "to": "_eyhF1cyMEfCuhbiBFBlMQg",
            "event": {
              "___type___": "Event",
              "xmi_id": "_eyhF3cyMEfCuhbiBFBlMQg",
              "name": "card_detected"
            }
          },
          {
            "___type___": "Transition",
            "xmi_id": "_eyhF3syMEfCuhbiBFBlMQg",
            "from": "_eyhF1cyMEfCuhbiBFBlMQg",
            "to": "_eyhF1MyMEfCuhbiBFBlMQg",
            "action": {
              "___type___": "Action",
              "xmi_id": "_eyhF38yMEfCuhbiBFBlMQg",
              "code": "eject card"
            },
            "guard": {
              "___type___": "Guard",
              "xmi_id": "_eyhF4MyMEfCuhbiBFBlMQg",
              "condition": "invalid card"
            }
          },
          {
            "___type___": "Transition",
            "xmi_id": "_eyhF4cyMEfCuhbiBFBlMQg",
            "from": "_eyhF1cyMEfCuhbiBFBlMQg",
            "to": "_eyhF1syMEfCuhbiBFBlMQg",
            "guard": {
              "___type___": "Guard",
              "xmi_id": "_eyhF4syMEfCuhbiBFBlMQg",
              "condition": "valid card"
            }
          },
          {
            "___type___": "Transition",
            "xmi_id": "_eyhF48yMEfCuhbiBFBlMQg",
            "from": "_eyhF1syMEfCuhbiBFBlMQg",
            "to": "_eyhF1MyMEfCuhbiBFBlMQg",
            "event": {
              "___type___": "TimeEvent",
              "xmi_id": "_eyhF5MyMEfCuhbiBFBlMQg",
              "name": "time out",
              "time": 1000.0
            },
            "action": {
              "___type___": "Action",
              "xmi_id": "_eyhF5cyMEfCuhbiBFBlMQg",
              "code": "eject card"
            }
          }
        ],
        "description": "The ATM is working normally"
      }
    ],
    "transitions": [],
    "description": "ATM"
  }
]

The user has selected the following model element(s): 
  - Object of type Transition with ID: _eyhF3MyMEfCuhbiBFBlMQg


===== MODEL CONSTRAINTS =====
Before generating new model elements:
- Parse the current model above.
- Identify which elements already exist (e.g., room numbers, IDs, guest names).
- DO NOT recreate or duplicate any existing elements.
- ONLY generate new elements as required by the user request.

===== EXAMPLE JSON RESPONSE =====

Example model:
{
  "___type___": "StateMachine",
  "xmi_id": "_DWwJsMyLEfCuhbiBFBlMQg",
  "states": [
    {
      "___type___": "State",
      "xmi_id": "_DWwJscyLEfCuhbiBFBlMQg",
      "isInitial": true,
      "isFinal": true,
      "name": "name_example"
    },
    {
      "___type___": "CompositeState",
      "xmi_id": "_DWwJssyLEfCuhbiBFBlMQg",
      "isInitial": true,
      "isFinal": true,
      "name": "name_example",
      "states": [],
      "transitions": [
        {
          "___type___": "Transition",
          "xmi_id": "_DWwJs8yLEfCuhbiBFBlMQg",
          "from": "_DWwJscyLEfCuhbiBFBlMQg",
          "to": "_DWwJscyLEfCuhbiBFBlMQg",
          "event": {
            "___type___": "TimeEvent",
            "xmi_id": "_DWwJtMyLEfCuhbiBFBlMQg",
            "name": "name_example",
            "time": 1.0
          },
          "action": {
            "___type___": "Action",
            "xmi_id": "_DWwJtcyLEfCuhbiBFBlMQg",
            "code": "code_example"
          },
          "guard": {
            "___type___": "Guard",
            "xmi_id": "_DWwJtsyLEfCuhbiBFBlMQg",
            "condition": "condition_example"
          }
        }
      ],
      "description": "description_example"
    }
  ],
  "transitions": [],
  "description": "description_example"
}


===== HISTORY / NOTES =====
before replying, verify:
- That your JSON is valid and properly structured.
- That all class and attribute names exist in the metamodel.
- That your output is not in the present model and relevant to the request.

- The root object of your response should be a VALID object, with its ___type___ identifier and attributes.

===== CONVERSATION HISTORY =====
EMF Kaizen: Welcome to EMF Kaizen! Ask me anything about your model.

You: Create two states connected by a transition with guard and action||01:31

EMF Kaizen: Processing recommendation request [#1]...

EMF Kaizen: The recommendation details can be found in the EMF Kaizen Results view.

How else can I help you?||01:32

You: Create a composite state with two connected states inside||01:32

EMF Kaizen: Processing recommendation request [#2]...

EMF Kaizen: The recommendation details can be found in the EMF Kaizen Results view.

How else can I help you?||01:32

You: Translate the current model into Spanish||01:32

EMF Kaizen: Processing recommendation request [#3]...

EMF Kaizen: The recommendation details can be found in the EMF Kaizen Results view.

How else can I help you?||01:32

You: create a final state for the selected element||01:32

EMF Kaizen: Processing recommendation request [#4]...

EMF Kaizen: The recommendation details can be found in the EMF Kaizen Results view.

How else can I help you?||01:33

You: recommend more substates for Operational||01:33

EMF Kaizen: Processing recommendation request [#5]...

EMF Kaizen: The recommendation details can be found in the EMF Kaizen Results view.

How else can I help you?||01:33

You: recommend guards and actions for the selected transition||01:34

EMF Kaizen: Processing recommendation request [#6]...

EMF Kaizen: The recommendation details can be found in the EMF Kaizen Results view.

How else can I help you?||01:34

You: Create the full details of the Transaction State||01:34

EMF Kaizen: Processing recommendation request [#7]...

EMF Kaizen: The recommendation details can be found in the EMF Kaizen Results view.

How else can I help you?||01:34

You: Create a composite state to model ending the session with the ATM, in full detail||01:34

EMF Kaizen: Processing recommendation request [#8]...
---- END OF HISTORY ----

